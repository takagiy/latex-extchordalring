\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{extchordalring}[2020/9/20 v0.2.0]
\RequirePackage{xparse}
\RequirePackage{xstring}
\RequirePackage{trimspaces}
\RequirePackage{tikz}
\RequirePackage{listofitems}

\DeclareOption{noprefix}{\newcommand\CR{\xcrCR}}
\ProcessOptions\relax

\NewDocumentCommand\xcrNodeStyle{m}{
  \tikzset{xcrNode/.style={#1}}
}

\xcrNodeStyle{
  shape=circle,
  fill=black,
}

\NewDocumentCommand\xcrCR{r()o}{
  \IfSubStr{#1}{,} {
    \xcr@CR@detail#1\relax#2\relax
  } {
    \xcr@CR@detail#1,\relax#2\relax
  }
}

\def\xcr@CR@detail#1,#2\relax#3\relax{
  \pgfmathsetmacro{\xcr@before@n}{#1-1}
  \draw \foreach \xcr@i in {0,...,\xcr@before@n} {
    (90-\xcr@i*360/#1:2) node[xcrNode] (\xcr@i) {}
    
    (90-\xcr@i*360/#1:2.5) node {\xcr@i}

    \IfNoValueT{#3} {
      (\xcr@i) -- ({90-(\xcr@i+1)*360/#1}:2)

      \foreach \xcr@j[
        evaluate=\xcr@j = \trim@spaces{\xcr@j}
      ] in {#2} {
        (\xcr@i) -- ({90-(\xcr@i+\xcr@j)*360/#1}:2)
      }
    }
  };
  \IfNoValueF{#3} {
    \foreach \xcr@path@nodes in {#3} {
      \xcr@connect@nodes\xcr@path@nodes\relax
    }
  }
}

\def\xcr@connect@nodes#1\relax{
  \setsepchar{ }
  \readlist*\xcr@nodes@list{#1}
  \foreachitem \xcr@node \in \xcr@nodes@list {
    \ifx\xcr@node\empty
    \else
      \ifnum\xcr@nodecnt>1
        \draw (\xcr@prev@node) -- (\xcr@node);
      \fi
      \edef\xcr@prev@node{\xcr@node}
    \fi
  }
}
